# inno setup 配置文件

``` js
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\istask.dll"; DestDir: "{app}"; Flags: ignoreversion; Attribs: hidden
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\{#MyAppExeName}"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\cef.pak"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\cef_100_percent.pak"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\cef_200_percent.pak"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\cef_extensions.pak"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\cef_sandbox.lib"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\chrome_100_percent.pak"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\chrome_200_percent.pak"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\chrome_elf.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\csFun.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\congshang.exe"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\CSupdate.exe"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\d3dcompiler_43.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\d3dcompiler_47.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\devtools_resources.pak"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\guiclient.exe"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\icudtl.dat"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\im.imh"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\libcef.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\libcef.lib"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\libeay32.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\libEGL.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\libGLESv2.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\mi.mih"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\mime.types"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\miUpdator.exe"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\natives_blob.bin"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\Project2.exe"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\Release.7z"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\resources.pak"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\snapshot_blob.bin"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\sqlite3.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\ssleay32.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\psvince.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\tw.sph"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\v8_context_snapshot.bin"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\vk_swiftshader.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\vk_swiftshader_icd.json"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\vulkan-1.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\widevinecdmadapter.dll"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\wow_helper.exe"; DestDir: "{app}"; Flags: ignoreversion
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\cache\*"; DestDir: "{app}\cache\"; Flags: ignoreversion recursesubdirs createallsubdirs
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\locales\*"; DestDir: "{app}\locales\"; Flags: ignoreversion recursesubdirs createallsubdirs
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\plugins\*"; DestDir: "{app}\plugins\"; Flags: ignoreversion recursesubdirs createallsubdirs
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\registry\*"; DestDir: "{app}\registry\"; Flags: ignoreversion recursesubdirs createallsubdirs
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\res\*"; DestDir: "{app}\res\"; Flags: ignoreversion recursesubdirs createallsubdirs
Source: "C:\Users\admin\Desktop\新建文件夹 (2)\congshang-1.0.3.129\swiftshader\*"; DestDir: "{app}\swiftshader\"; Flags: ignoreversion recursesubdirs createallsubdirs
```

::: err
注意
::: 

##### VMI 错误问题

![VMI错误](/VMI/vmierr.png)

在Innosetup打包软件的程序时安装时遇到SWbemObjectSet：无效查询的问题怎么解决？

首先此问题是出在Innosetup一个公有的作为安装程序都会使用的一个判断程序是否正在运行的函数，目前个人可以明白发生的原因但是没有很完美的解决方案，大家如果有更好的方案也可以一起分享！
```
 function IsAppRunning(const FileName : string): Boolean;
 var
     FSWbemLocator: Variant;
     FWMIService   : Variant;
     FWbemObjectSet: Variant;
 begin
     Result := false;
     FSWbemLocator := CreateOleObject('WBEMScripting.SWBEMLocator');
     FWMIService := FSWbemLocator.ConnectServer('', 'root\CIMV2', '', '');
     FWbemObjectSet := FWMIService.ExecQuery(Format('SELECT Name FR2OM Win32_Process Where Name="%s"',[FileName]));
     Result := (FWbemObjectSet.Count > 0);
     FWbemObjectSet := Unassigned;
     FWMIService := Unassigned;
     FSWbemLocator := Unassigned;
 end;

 ```

利用这个函数可以在输入进程名的同时查询到windows是否正在运行此程序，但是在查询过程中会在ExecQuery函数时发送问题所以导致此问题的发生。

发生原因：
首先这个函数的撰写是基于微软的WMI的COM API来实现的，调用的都是微软底层的接口，在ExecQuery函数执行后，根据微软的文档，会返回一个Swbemobjectset 对象(Swbemobject对象的集合)，但是如果用户此时电脑里WMI服务发生错误，执行WQL查询失败时，会返回一个Err的错误
![VMI错误](/VMI/vmierr2.png)

#### 个人的解决方案：
首先我的方法其实也不算解决，目前个人是在安装时写入程序注册表，如果检测到已经安装过则可能开启软件，此时要检测软件是否正在运行，而如果是首次安装，就不进行检测防止用户无法安装。

#### 理想的解决方案（未实现）
根据微软的官方文档，查询返回空结果集不是错误。无论strQuery参数中是否请求了键属性，ExecQuery 方法都会返回键属性。如果在执行此方法时发生错误并且您不使用wbemFlagReturnImmediately标志，则在您尝试访问返回的对象集之前不会设置Err对象。但是，如果您使用wbemFlagReturnWhenComplete标志，则会在调用ExecQuery方法时设置 Err 对象。
